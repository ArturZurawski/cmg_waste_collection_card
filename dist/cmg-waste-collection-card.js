class n extends HTMLElement{constructor(){super(),this._expanded=!1,this.attachShadow({mode:"open"})}setConfig(n){this._config={show_title:!1,icon_style:"icon",title:"Waste Collection",...n},this.render()}set hass(n){const t=this._hass;if(this._hass=n,!t)return void this.render();const e=n.states["sensor.waste_collection_waste_sensors"];if(!t.states["sensor.waste_collection_waste_sensors"]||!e)return void this.render();const o=e.attributes.entity_ids||[];let s=!1;for(const e of o){const o=n.states[e],a=t.states[e];if(!a||!o||a.state!==o.state){s=!0;break}}s&&this.render()}_toggleExpanded(){this._expanded=!this._expanded,this.render()}_getTodayTypes(){if(!this._hass)return[];const n=this._hass.states["sensor.waste_collection_waste_sensors"];if(!n)return[];const t=n.attributes.entity_ids||[],e=new Date;e.setHours(0,0,0,0);const o=[];for(const n of t){const t=this._hass.states[n];if(t&&"unavailable"!==t.state&&"unknown"!==t.state)try{const s=new Date(t.state);s.setHours(0,0,0,0),s.getTime()===e.getTime()&&o.push({name:t.attributes.friendly_name?.replace("Waste Collection ","")||"Unknown",icon:t.attributes.icon||"mdi:delete",color:t.attributes.color||"#000000",next_date:t.state,days_until:0,is_today:!0,entity_id:n})}catch(t){console.warn("[CMG Card] Error parsing date for",n,t)}}return o}_getTomorrowTypes(){if(!this._hass)return[];const n=this._hass.states["sensor.waste_collection_waste_sensors"];if(!n)return[];const t=n.attributes.entity_ids||[],e=new Date;e.setHours(0,0,0,0);const o=new Date(e);o.setDate(o.getDate()+1);const s=[];for(const n of t){const t=this._hass.states[n];if(t&&"unavailable"!==t.state&&"unknown"!==t.state)try{const e=new Date(t.state);e.setHours(0,0,0,0),e.getTime()===o.getTime()&&s.push({name:t.attributes.friendly_name?.replace("Waste Collection ","")||"Unknown",icon:t.attributes.icon||"mdi:delete",color:t.attributes.color||"#000000",next_date:t.state,days_until:1,is_tomorrow:!0,entity_id:n})}catch(t){console.warn("[CMG Card] Error parsing date for",n,t)}}return s}_getAllMonitoredTypes(){if(!this._hass)return[];const n=this._hass.states["sensor.waste_collection_waste_sensors"];if(!n)return[];const t=n.attributes.entity_ids||[],e=new Date;e.setHours(0,0,0,0);const o=[];for(const n of t){const t=this._hass.states[n];if(t&&"unavailable"!==t.state&&"unknown"!==t.state)try{const s=new Date(t.state);s.setHours(0,0,0,0);const a=Math.floor((s.getTime()-e.getTime())/864e5);o.push({name:t.attributes.friendly_name?.replace("Waste Collection ","")||"Unknown",icon:t.attributes.icon||"mdi:delete",color:t.attributes.color||"#000000",next_date:t.state,days_until:a,is_today:0===a,is_tomorrow:1===a,entity_id:n})}catch(t){console.warn("[CMG Card] Error parsing date for",n,t)}}return o.sort((n,t)=>new Date(n.next_date).getTime()-new Date(t.next_date).getTime()),o}_getWasteTypeInfo(n){if(!this._hass)return null;const t=`sensor.waste_collection_${this._normalizeForEntityId(n)}`,e=this._hass.states[t];return e?{name:n,icon:e.attributes.icon||"mdi:delete",color:e.attributes.color||"#000000",next_date:"unknown"!==e.state&&"unavailable"!==e.state?e.state:null,days_until:e.attributes.days_until??null,is_today:e.attributes.is_today||!1,is_tomorrow:e.attributes.is_tomorrow||!1}:(console.warn(`Sensor not found for ${n}: ${t}`),{name:n,icon:"mdi:delete",color:"#000000",next_date:null,days_until:null,is_today:!1,is_tomorrow:!1})}_normalizeForEntityId(n){return n.toLowerCase().replace(/ /g,"_")}_getDaysText(n){if(null===n.days_until)return"";if(0===n.days_until)return"dziś";if(1===n.days_until)return"jutro";if(n.days_until<7)return`za ${n.days_until} dni`;const t=Math.floor(n.days_until/7);return 1===t?"za tydzień":t<5?`za ${t} tygodnie`:`za ${t} tygodni`}_getDaysClass(n){return null===n?"":0===n?"today":1===n?"tomorrow":n<7?"this-week":""}_formatDate(n){try{const t=new Date(n),e=t.getDate().toString().padStart(2,"0");return`${e}.${(t.getMonth()+1).toString().padStart(2,"0")}`}catch{return n}}_renderIcon(n){return`\n      <div class="waste-icon" style="${"colored_background"===this._config.icon_style?`background-color: ${n.color}20; color: ${n.color};`:`color: ${n.color};`}" title="${n.name}">\n        <ha-icon icon="${n.icon}"></ha-icon>\n      </div>\n    `}_renderExpandedType(n){const t=this._getDaysText(n),e=n.next_date?`\n        <span class="date-value">${this._formatDate(n.next_date)}</span>\n        <span class="days-until ${this._getDaysClass(n.days_until)}">${t}</span>\n      `:'<span class="no-date">Brak dat</span>';return`\n      <div class="waste-type-row">\n        <div class="waste-info">\n          <ha-icon icon="${n.icon}" style="color: ${n.color};"></ha-icon>\n          <span class="waste-name">${n.name}</span>\n        </div>\n        <div class="waste-date">\n          ${e}\n        </div>\n      </div>\n    `}_getSensorIcon(n,t){if(!this._hass)return t;const e=this._hass.states[n];return e&&e.attributes.icon||t}render(){if(!this._hass||!this._config||!this.shadowRoot)return;const n=this._getTodayTypes(),t=this._getTomorrowTypes(),e=this._getAllMonitoredTypes(),o=n.length>0?n.map(n=>this._renderIcon(n)).join(""):'<ha-icon icon="mdi:border-none-variant" style="color: var(--secondary-text-color); --mdi-icon-size: 24px;"></ha-icon>',s=t.length>0?t.map(n=>this._renderIcon(n)).join(""):'<ha-icon icon="mdi:border-none-variant" style="color: var(--secondary-text-color); --mdi-icon-size: 24px;"></ha-icon>',a=this._getSensorIcon("sensor.waste_collection_today_collection","mdi:calendar-today"),i=this._getSensorIcon("sensor.waste_collection_tomorrow_collection","mdi:calendar"),r=this._expanded?"mdi:chevron-up":"mdi:calendar-multiselect",c=this._expanded&&e.length>0?`\n        <div class="expanded-view">\n          <div class="divider"></div>\n          ${e.map(n=>this._renderExpandedType(n)).join("")}\n        </div>\n      `:"";this.shadowRoot.innerHTML=`\n      <style>\n        :host {\n          display: block;\n        }\n\n        ha-card {\n          padding: 12px;\n        }\n\n        .card-header {\n          font-size: 20px;\n          font-weight: 500;\n          margin-bottom: 12px;\n        }\n\n        .card-content {\n          display: flex;\n          flex-direction: column;\n          gap: 8px;\n        }\n\n        .compact-view {\n          display: flex;\n          flex-direction: row;\n          align-items: center;\n          gap: 16px;\n          padding: 8px 0;\n        }\n\n        .day-section {\n          display: flex;\n          align-items: center;\n          gap: 8px;\n          flex: 1;\n        }\n\n        .day-label {\n          font-weight: 500;\n          font-size: 14px;\n          color: var(--secondary-text-color);\n          white-space: nowrap;\n        }\n\n        .day-label-icon {\n          --mdi-icon-size: 24px;\n          color: var(--secondary-text-color);\n          flex-shrink: 0;\n        }\n\n        .icons-row {\n          display: flex;\n          gap: 6px;\n          flex-wrap: wrap;\n          align-items: center;\n        }\n\n        .waste-icon {\n          width: 32px;\n          height: 32px;\n          border-radius: 50%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          transition: transform 0.2s;\n        }\n\n        .waste-icon:hover {\n          transform: scale(1.1);\n        }\n\n        .waste-icon ha-icon {\n          --mdi-icon-size: 20px;\n        }\n\n        .no-collection {\n          color: var(--secondary-text-color);\n          font-style: italic;\n        }\n\n        .expand-button {\n          display: flex;\n          justify-content: center;\n          padding: 8px;\n          cursor: pointer;\n          color: var(--primary-text-color);\n          opacity: 0.6;\n          transition: opacity 0.2s;\n        }\n\n        .expand-button:hover {\n          opacity: 1;\n        }\n\n        .divider {\n          height: 1px;\n          background-color: var(--divider-color);\n          margin: 8px 0;\n        }\n\n        .expanded-view {\n          display: flex;\n          flex-direction: column;\n          gap: 4px;\n        }\n\n        .waste-type-row {\n          display: flex;\n          justify-content: space-between;\n          align-items: center;\n          padding: 8px 12px;\n          border-radius: 6px;\n          background-color: var(--secondary-background-color);\n        }\n\n        .waste-info {\n          display: flex;\n          align-items: center;\n          gap: 10px;\n        }\n\n        .waste-info ha-icon {\n          --mdi-icon-size: 20px;\n        }\n\n        .waste-name {\n          font-weight: 500;\n          font-size: 14px;\n        }\n\n        .waste-date {\n          display: flex;\n          flex-direction: column;\n          align-items: flex-end;\n          gap: 2px;\n        }\n\n        .date-value {\n          font-weight: 500;\n          font-size: 13px;\n        }\n\n        .days-until {\n          font-size: 11px;\n          color: var(--secondary-text-color);\n        }\n\n        .days-until.today {\n          color: var(--error-color);\n          font-weight: 600;\n        }\n\n        .days-until.tomorrow {\n          color: var(--warning-color);\n          font-weight: 600;\n        }\n\n        .days-until.this-week {\n          color: var(--info-color);\n        }\n\n        .no-date {\n          color: var(--secondary-text-color);\n          font-style: italic;\n        }\n      </style>\n\n      <ha-card>\n        ${this._config.show_title&&this._config.title?`<div class="card-header">${this._config.title}</div>`:""}\n\n        <div class="card-content">\n          <div class="compact-view">\n            <div class="day-section">\n              <ha-icon icon="${a}" class="day-label-icon" title="Dzisiaj"></ha-icon>\n              <div class="icons-row">${o}</div>\n            </div>\n\n            <div class="day-section">\n              <ha-icon icon="${i}" class="day-label-icon" title="Jutro"></ha-icon>\n              <div class="icons-row">${s}</div>\n            </div>\n\n            <div class="expand-button">\n              <ha-icon icon="${r}"></ha-icon>\n            </div>\n          </div>\n\n          ${c}\n        </div>\n      </ha-card>\n    `;const l=this.shadowRoot.querySelector(".expand-button");l&&l.addEventListener("click",()=>this._toggleExpanded())}getCardSize(){return this._expanded?5+this._getAllMonitoredTypes().length:3}static getStubConfig(){return{title:"Waste Collection",show_title:!1,icon_style:"icon"}}}customElements.define("cmg-waste-collection-card",n),window.customCards=window.customCards||[],window.customCards.push({type:"cmg-waste-collection-card",name:"CMG Waste Collection Card",description:"A card to display waste collection schedule",preview:!0}),console.info("%c CMG-WASTE-COLLECTION-CARD %c Version 0.0.1","color: orange; font-weight: bold; background: black","color: white; font-weight: bold; background: dimgray");
